{% extends "base.html" %}
{% block title %}My Todos{% endblock title %}

{% block content %}
    <div class="max-w-2xl mx-auto mt-10 p-6 bg-white shadow rounded-lg">
        <h2 class="page-title">My Todos</h2>

        <div class="mb-4 flex justify-between">
            <a href="{% url 'add_todo' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition
                {% if incomplete_count >= 20 %} opacity-50 cursor-not-allowed pointer-events-none {% endif %}">
                + Add Todo
            </a>
            <span class="text-gray-600 text-sm">
                Total: {{ todos|length }} | Completed: {{ completed_count }} | Incomplete: {{ incomplete_count }}
            </span>
        </div>

        {% if todos %}
            <ul class="space-y-4">
                {% for todo in todos %}
                    <li class="p-4 rounded-lg {% if todo.is_completed %}bg-green-50{% else %}bg-gray-50{% endif %} hover:shadow-md transition">
                        <div>
                            <h3 class="font-semibold {% if todo.is_completed %}line-through text-gray-500{% endif %} break-words">
                                {{ todo.title }}
                            </h3>
                            <p class="text-sm text-gray-500">
                                Priority: {{ todo.priority }}
                                {% if todo.due_date %}
                                    | Due: {{ todo.due_date|date:"M d, Y" }}
                                {% endif %}
                            </p>
                            <p class="text-xs {% if todo.is_completed %}text-green-600{% else %}text-red-600{% endif %}">
                                {% if todo.is_completed %}✔ Completed{% else %}⏳ Incomplete{% endif %}
                            </p>
                        </div>

                        <!-- Buttons below -->
                        <div class="mt-3 flex flex-wrap gap-2">
                            {% if not todo.is_completed %}
                                <a href="{% url 'mark_completed' todo.pk %}" 
                                class="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm">
                                    Mark Complete
                                </a>
                            {% else %}
                                <a href="{% url 'mark_incomplete' todo.pk %}" 
                                class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm">
                                    Mark Incomplete
                                </a>
                            {% endif %}
                            <a href="{% url 'update_todo' todo.pk %}" 
                            class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                                Edit
                            </a>
                            <a href="{% url 'todo_details' todo.pk %}" 
                            class="px-3 py-1 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm">
                                Details
                            </a>
                            <a href="{% url 'delete_todo' todo.pk %}" 
                            class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
                                Delete
                            </a>
                        </div>
                    </li>
                {% empty %}
                    <li class="text-gray-500">
                        No todos found. 
                        <a href="{% url 'add_todo' %}" class="text-blue-600 hover:underline">Add a new todo</a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
{% endblock %}
